<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>XAUUSD Analyzer AI</title>
<style>
body{font-family:sans-serif; background:#071022; color:#e6eef8; padding:20px;}
input, select, button{padding:6px; margin:4px; border-radius:4px;}
pre{background:#031223; padding:12px; border-radius:8px; overflow:auto;}
.high{color:#2dd4bf; font-weight:700;}
</style>
</head>
<body>

<h1>XAUUSD Analyzer AI</h1>

<label>Harga Spot (USD/oz)</label>
<input type="number" id="price" value="3620">

<label>Volatilitas</label>
<input type="number" id="vol" value="30">

<label>Risk/Reward Strategy</label>
<select id="rrStrategy">
  <option value="default" selected>Default</option>
  <option value="ideal">Ideal</option>
  <option value="safe">Safe</option>
</select>

<label>Mode</label>
<select id="mode">
  <option value="limit" selected>Limit</option>
  <option value="stop">Stop</option>
</select>

<button id="gen">Generate AI Analysis</button>

<h3>Hasil AI:</h3>
<pre id="output">{}</pre>

<script>
document.getElementById("gen").addEventListener("click", async () => {
  const output = document.getElementById("output");
  output.textContent = "⏳ Memproses...";

  const payload = {
    price: parseFloat(document.getElementById("price").value),
    volatility: parseFloat(document.getElementById("vol").value),
    rrStrategy: document.getElementById("rrStrategy").value,
    mode: document.getElementById("mode").value
  };

  try {
    const res = await fetch("/api/ai", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    const result = data.result;

    if(result.ai_output) {
      output.textContent = result.ai_output + (result.error ? `\n⚠️ ${result.error}` : "");
    } else {
      // highlight probabilitas tinggi
      const bp = result.buy_probability || 0;
      const sp = result.sell_probability || 0;
      output.innerHTML = JSON.stringify(result, null, 2)
        .replace(`"buy_probability": ${bp}`, `"buy_probability": <span class="high">${bp}</span>`)
        .replace(`"sell_probability": ${sp}`, `"sell_probability": <span class="high">${sp}</span>`);
    }

  } catch(err) {
    output.textContent = `Error: ${err.message}`;
  }
});
</script>

</body>
</html>
